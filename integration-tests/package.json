{
    "name": "echo-test",
    "version": "1.0.0",
    "description": "Examples integration tests",
    "author": "Cartesi",
    "license": "Apache-2.0",
    "scripts": {
        "generateTypes": "proto-loader-gen-types --grpcLib @grpc/grpc-js --outDir generated-src/proto ../grpc-interfaces/server-manager.proto",
        "setupConsole": "cd ../frontend-console/ && yarn install && yarn build && cd ../integration-tests/ ",
        "buildImages": "wrap () { cd ../$1/ && pwd && docker buildx bake && cd ../integration-tests/ ;}; wrap",
        "startEnvironment:prod": "wrap(){ cd ../$1/ && docker-compose -f ../docker-compose.yml -f docker-compose.override.yml up -d && cd ../integration-tests/ ;}; wrap",
        "startEnvironment:host": "wrap(){ cd ../$1/ && docker-compose -f ../docker-compose.yml -f docker-compose.override.yml -f ../docker-compose-host.yml up -d && cd ../integration-tests/ ;}; wrap",
        "stopEnvironment": "wrap(){ target_dir=$(cat target) && cd ../$target_dir/ && pwd && docker-compose -f ../docker-compose.yml -f docker-compose.override.yml down -v ; }; wrap",
        "pretest:ci": "yarn generateTypes && yarn setupConsole",
        "pretest:prod": "yarn generateTypes && yarn setupConsole",
        "pretest:host": "yarn generateTypes && yarn setupConsole ",
        "mocha:prod": "wrap () { mocha -r ts-node/register ./$1/*test.ts -t 3m -b --address 0.0.0.0:5001 --environment prod $* ; }; wrap",
        "mocha:host": "wrap () { mocha -r ts-node/register ./$1/*test.ts -t 3m -b --address 0.0.0.0:5001 --environment host $* ; }; wrap",
        "saveTarget": "wrap () { echo $1 > target ;}; wrap",
        "test:ci": "wrap () { yarn saveTarget $1 && yarn startEnvironment:prod $1 && yarn mocha:prod $*  ; }; wrap",
        "test:prod": "wrap () { yarn saveTarget $1 && yarn buildImages $1 && yarn startEnvironment:prod $1 && yarn mocha:prod $* ;}; wrap",
        "test:host": "wrap () { yarn saveTarget $1 && yarn startEnvironment:host $1 && yarn mocha:host $*  ;}; wrap",
        "test": "wrap () { yarn test:prod $* && yarn test:host $* ;}; wrap",
        "posttest:prod": "wrap(){ yarn stopEnvironment && rm ./target;};wrap",
        "posttest:ci": "wrap(){ yarn stopEnvironment && rm ./target;};wrap",
        "posttest:host": "wrap(){ yarn stopEnvironment && rm ./target;};wrap",
        "saveLogs": "saveLogs () { mkdirp logs && cd ../$1/ && docker-compose -f ../docker-compose.yml -f docker-compose.override.yml logs --timestamps --no-log-prefix --no-color $2 > ../integration-tests/logs/$2.log; }; saveLogs"
    },
    "devDependencies": {
        "@grpc/grpc-js": "^1.6.7",
        "@grpc/proto-loader": "^0.6.12",
        "@types/chai": "^4.3.1",
        "@types/chai-as-promised": "^7.1.5",
        "@types/google-protobuf": "^3.15.5",
        "@types/mocha": "^9.1.1",
        "@types/node": "^17.0.33",
        "chai": "^4.3.6",
        "chai-as-promised": "^7.1.1",
        "mkdirp": "^1.0.4",
        "mocha": "^9.2.2",
        "prettier": "2.7.1",
        "ts-node": "^10.7.0",
        "typescript": "^4.6.4"
    }
}
